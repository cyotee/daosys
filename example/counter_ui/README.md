# Counter UI (Contractlist-driven)

This is a small, Counter-specific UI that generates function controls from a `wagmi-declare` contractlist.

It is intentionally **not** the DaoSYS frontend.

## Prereqs

- Anvil running at `http://127.0.0.1:8545`
- A browser wallet (MetaMask) connected to Anvil (chain id `31337`)

## Deploy Counter Diamond

From the example project:

```bash
cd ../
cd example
forge script script/DeployCounter.s.sol --rpc-url http://127.0.0.1:8545 --broadcast
```

Copy the printed Counter Diamond address.

## Run the UI

```bash
cd example/counter_ui
npm install
npm run dev
```

Open the Vite URL (usually `http://localhost:5173`) and paste the Counter Diamond address.

### Connecting a Wallet

You have two options:

1) **Browser wallet (MetaMask)**
	- Click **Connect Wallet** and connect to Anvil (chain id `31337`).

2) **Dev Wallet (no extension; local Anvil only)**
	- Toggle **Dev Wallet (local Anvil)** and paste an Anvil private key.
	- This lets the UI send transactions even in automation environments.

Anvil default key #0 (local only):

```text
0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
```

## Contractlist + ABI Inputs

- Contractlist: `../schema/counter.contractlist.json` (generated by `wagmi-declare generate`)
- ABI: `../schema/counter.abi.json` (exported from Foundry artifact for `CounterTarget`)

The UI uses the contractlist to decide what to render, and the ABI to actually call the contract.

## Regenerating the Contractlist (CLI)

From `example/`:

```bash
forge build

# If `../lib/wagmi-declare/dist/cli.mjs` doesn't exist yet:
npm --prefix ../lib/wagmi-declare run build

# 1) ABI (Diamond-facing): extract ABI for CounterTarget
node -e "const fs=require('fs'); const j=JSON.parse(fs.readFileSync('out/CounterTarget.sol/CounterTarget.json','utf8')); fs.writeFileSync('schema/counter.abi.json', JSON.stringify(j.abi, null, 2));"

# 2) Contractlist: generate from ABI using wagmi-declare CLI
node ../lib/wagmi-declare/dist/cli.mjs generate \
	--abi ./schema/counter.abi.json \
	--chain-id 31337 \
	--name "Counter Diamond" \
	--hook-name "useCounterDiamond" \
	--include-view \
	--output ./schema/counter.contractlist.json

node ../lib/wagmi-declare/dist/cli.mjs validate --file ./schema/counter.contractlist.json
```
